{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[1] \"Training forest 1 of 4\"\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "Loading required package: compiler\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[1] \"Training forest 2 of 4\"\n",
      "[1] \"Training forest 3 of 4\"\n",
      "[1] \"Training forest 4 of 4\"\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "dummies-1.5.6 provided by Decision Patterns\n",
      "\n",
      "AUC 0.3.0\n",
      "Type AUCNews() to see the change log and ?AUC to get an overview.\n",
      "Loading required package: parallel\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "OOB error rate:  5.333333 %\n",
      "OOB error rate:  4.666667 %\n",
      "OOB error rate:  4 %\n",
      "OOB error rate:  4 %\n",
      "$oobError\n",
      "[1] 0.05333333 0.04666667 0.04000000 0.04000000\n",
      "\n",
      "$oobAUC\n",
      "[1] 0.9964444 0.9972222 0.9972889 0.9974222\n",
      "\n",
      "$best.idx\n",
      "[1] 4\n",
      "\n"
     ]
    }
   ],
   "source": [
    "rm(list = ls())\n",
    "source('/Users/tyler/RerF/Code/Classifiers/rfr_function.R')\n",
    "source('/Users/tyler/RerF/Code/Classifiers/randmat.R')\n",
    "source('/Users/tyler/RerF/Code/Classifiers/rerf_train.R')\n",
    "source('/Users/tyler/RerF/Code/Classifiers/select_model.R')\n",
    "source('/Users/tyler/RerF/Code/Utils/strcorr.R')\n",
    "source('/Users/tyler/RerF/Code/Utils/feature_importance.R')\n",
    "\n",
    "Xtrain <- as.matrix(iris[,1:4])\n",
    "p <- ncol(Xtrain)\n",
    "Ytrain <- as.numeric(iris[,5])\n",
    "nClasses <- length(unique(Ytrain))\n",
    "nTrees <- 250\n",
    "params <- list(trees = nTrees, randomMatrix = \"binary\", d = 1:4)\n",
    "forests <- rerf_train(Xtrain, Ytrain, params = params)\n",
    "\n",
    "mdl.select <- select_model(forests = forests$forests, Xtrain, Ytrain, NumCores =)\n",
    "print(mdl.select)\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "$s\n",
      "[1] 0.9414933\n",
      "\n",
      "$rho\n",
      "[1] 0.8525911\n",
      "\n"
     ]
    }
   ],
   "source": [
    "forest <- forests$forests[[mdl.select$best.idx]]\n",
    "predictmat <- predict(Xtrain, forest, 2L)\n",
    "sc <- strcorr(predictmat, Ytrain, nClasses)\n",
    "print(sc)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "$imp\n",
      " [1] 4080.9914463 4029.6066525 3339.7371155 3265.5592435  838.7631770\n",
      " [6]  599.5493889  527.8423179  519.3530029  508.8170535  478.6722160\n",
      "[11]  470.3369023  444.4192475  407.7900941  385.3219475  380.6853751\n",
      "[16]  375.0329838  360.2014387  301.9726360  293.8036766  291.2638722\n",
      "[21]  233.7266480  210.7430967  193.1150676  139.7184903  135.9808699\n",
      "[26]  131.1639537  125.5462489  121.9507192  111.9625178  111.3480237\n",
      "[31]  108.9000000   86.3807158   77.6652116   68.9695004   65.2654040\n",
      "[36]   59.2585034   56.2632724   56.0952381   54.0773563   50.7260731\n",
      "[41]   50.0000000   50.0000000   48.6551692   44.5811880   41.2562177\n",
      "[46]   34.1979909   27.4354854   26.6935149   17.9076903   16.2550020\n",
      "[51]   14.2814765   11.6293779   10.7138866    9.0552929    6.5000000\n",
      "[56]    5.6603774    4.0092199    3.0504202    2.4000000    2.3142857\n",
      "[61]    2.2105263    1.9545455    1.9354839    1.6939683    0.2645503\n",
      "\n",
      "$proj\n",
      "$proj[[1]]\n",
      "[1] 3 1\n",
      "\n",
      "$proj[[2]]\n",
      "[1] 4 1\n",
      "\n",
      "$proj[[3]]\n",
      "[1]  4 -1\n",
      "\n",
      "$proj[[4]]\n",
      "[1]  3 -1\n",
      "\n",
      "$proj[[5]]\n",
      "[1]  3 -1  4 -1\n",
      "\n",
      "$proj[[6]]\n",
      "[1]  2  1  3 -1\n",
      "\n",
      "$proj[[7]]\n",
      "[1]  3  1  4 -1\n",
      "\n",
      "$proj[[8]]\n",
      "[1] 3 1 4 1\n",
      "\n",
      "$proj[[9]]\n",
      "[1]  1 -1  3 -1\n",
      "\n",
      "$proj[[10]]\n",
      "[1] 1 1\n",
      "\n",
      "$proj[[11]]\n",
      "[1]  2 -1  4  1\n",
      "\n",
      "$proj[[12]]\n",
      "[1] 2 1 3 1\n",
      "\n",
      "$proj[[13]]\n",
      "[1]  3 -1  4  1\n",
      "\n",
      "$proj[[14]]\n",
      "[1]  1  1  3 -1\n",
      "\n",
      "$proj[[15]]\n",
      "[1] 1 1 3 1\n",
      "\n",
      "$proj[[16]]\n",
      "[1]  2 -1  3  1\n",
      "\n",
      "$proj[[17]]\n",
      "[1]  2  1  4 -1\n",
      "\n",
      "$proj[[18]]\n",
      "[1]  1  1  2 -1\n",
      "\n",
      "$proj[[19]]\n",
      "[1]  1 -1  3  1\n",
      "\n",
      "$proj[[20]]\n",
      "[1]  1 -1  2  1\n",
      "\n",
      "$proj[[21]]\n",
      "[1]  1 -1  3  1  4  1\n",
      "\n",
      "$proj[[22]]\n",
      "[1]  2 -1  4 -1\n",
      "\n",
      "$proj[[23]]\n",
      "[1]  1 -1\n",
      "\n",
      "$proj[[24]]\n",
      "[1]  2 -1  3 -1\n",
      "\n",
      "$proj[[25]]\n",
      "[1] 2 1 4 1\n",
      "\n",
      "$proj[[26]]\n",
      "[1] 2 1\n",
      "\n",
      "$proj[[27]]\n",
      "[1]  2 -1\n",
      "\n",
      "$proj[[28]]\n",
      "[1] 1 1 4 1\n",
      "\n",
      "$proj[[29]]\n",
      "[1]  1 -1  4 -1\n",
      "\n",
      "$proj[[30]]\n",
      "[1]  1  1  2 -1  3 -1\n",
      "\n",
      "$proj[[31]]\n",
      "[1] 1 1 3 1 4 1\n",
      "\n",
      "$proj[[32]]\n",
      "[1]  1  1  3 -1  4 -1\n",
      "\n",
      "$proj[[33]]\n",
      "[1]  1 -1  2 -1\n",
      "\n",
      "$proj[[34]]\n",
      "[1]  2 -1  3 -1  4  1\n",
      "\n",
      "$proj[[35]]\n",
      "[1]  2 -1  3 -1  4 -1\n",
      "\n",
      "$proj[[36]]\n",
      "[1]  2 -1  3  1  4  1\n",
      "\n",
      "$proj[[37]]\n",
      "[1] 1 1 2 1 4 1\n",
      "\n",
      "$proj[[38]]\n",
      "[1]  2  1  3 -1  4  1\n",
      "\n",
      "$proj[[39]]\n",
      "[1]  2  1  3 -1  4 -1\n",
      "\n",
      "$proj[[40]]\n",
      "[1]  1 -1  4  1\n",
      "\n",
      "$proj[[41]]\n",
      "[1]  1 -1  2  1  3  1  4  1\n",
      "\n",
      "$proj[[42]]\n",
      "[1] 2 1 3 1 4 1\n",
      "\n",
      "$proj[[43]]\n",
      "[1]  1 -1  3 -1  4 -1\n",
      "\n",
      "$proj[[44]]\n",
      "[1]  1 -1  2 -1  3 -1\n",
      "\n",
      "$proj[[45]]\n",
      "[1]  1  1  2 -1  4  1\n",
      "\n",
      "$proj[[46]]\n",
      "[1]  1  1  4 -1\n",
      "\n",
      "$proj[[47]]\n",
      "[1] 1 1 2 1\n",
      "\n",
      "$proj[[48]]\n",
      "[1]  1 -1  2  1  4 -1\n",
      "\n",
      "$proj[[49]]\n",
      "[1]  1 -1  2 -1  4 -1\n",
      "\n",
      "$proj[[50]]\n",
      "[1]  2 -1  3  1  4 -1\n",
      "\n",
      "$proj[[51]]\n",
      "[1]  1 -1  2  1  3  1\n",
      "\n",
      "$proj[[52]]\n",
      "[1]  1 -1  2  1  4  1\n",
      "\n",
      "$proj[[53]]\n",
      "[1]  1 -1  2  1  3 -1\n",
      "\n",
      "$proj[[54]]\n",
      "[1]  1  1  2 -1  3  1\n",
      "\n",
      "$proj[[55]]\n",
      "[1]  1 -1  3 -1  4  1\n",
      "\n",
      "$proj[[56]]\n",
      "[1]  1  1  3  1  4 -1\n",
      "\n",
      "$proj[[57]]\n",
      "[1]  1  1  2 -1  4 -1\n",
      "\n",
      "$proj[[58]]\n",
      "[1]  1  1  2  1  3 -1\n",
      "\n",
      "$proj[[59]]\n",
      "[1]  1  1  2  1  4 -1\n",
      "\n",
      "$proj[[60]]\n",
      "[1]  1 -1  2 -1  4  1\n",
      "\n",
      "$proj[[61]]\n",
      "[1]  1 -1  2 -1  3  1  4  1\n",
      "\n",
      "$proj[[62]]\n",
      "[1]  1 -1  3  1  4 -1\n",
      "\n",
      "$proj[[63]]\n",
      "[1]  2  1  3  1  4 -1\n",
      "\n",
      "$proj[[64]]\n",
      "[1]  1 -1  2 -1  3  1\n",
      "\n",
      "$proj[[65]]\n",
      "[1]  1 -1  2  1  3  1  4 -1\n",
      "\n",
      "\n"
     ]
    }
   ],
   "source": [
    "imp <- feature_importance(forest, 2L)\n",
    "print(imp)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": true
   },
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "R",
   "language": "R",
   "name": "ir"
  },
  "language_info": {
   "codemirror_mode": "r",
   "file_extension": ".r",
   "mimetype": "text/x-r-source",
   "name": "R",
   "pygments_lexer": "r",
   "version": "3.3.2"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 2
}
